<h1>CSV/Excel Column Selector</h1>

<div class="upload-section">
  <input type="file" (input)="uploadFile($event)" accept=".csv,.xlsx,.xls" />
  @if (fileName()) {
  <p class="file-name">Loaded: {{ fileName() }}</p>
  }
</div>

@if (csvData().length > 0) {
<!-- Column Selection Section -->
<div class="processing-section">
  <h3>Select Columns to Export</h3>
  <div class="column-selection">
    @for (header of headers(); track $index) {
    <label class="column-checkbox">
      <input
        type="checkbox"
        [checked]="selectedColumns().includes($index)"
        (change)="toggleColumn($index, $event)"
      />
      {{ header }}
    </label>
    }
  </div>

  <div class="processing-options">
    <label class="option-checkbox">
      <input
        type="checkbox"
        [(ngModel)]="validateBarcodes"
        (change)="updateProcessingOptions()"
      />
      Validate Barcode Length
    </label>
  </div>

  <div class="action-buttons">
    <button
      class="btn-process"
      (click)="processData()"
      [disabled]="selectedColumns().length === 0"
    >
      Export Selected Columns
    </button>
    <button
      class="btn-download"
      (click)="downloadProcessedData()"
      [disabled]="!processedData().length"
    >
      Download CSV
    </button>
  </div>
</div>

<!-- Original Data Table -->
<div class="table-section">
  <h3>Original Data</h3>
  <div class="table-container">
    <table class="csv-table">
      <thead>
        <tr>
          <th class="row-number">#</th>
          @for (header of headers(); track $index) {
          <th [class.selected-column]="selectedColumns().includes($index)">
            {{ header }}
          </th>
          }
        </tr>
      </thead>
      <tbody>
        @for (row of csvData(); track $index) {
        <tr>
          <td class="row-number">{{ $index + 1 }}</td>
          @for (cell of row; track $index) {
          <td [class.selected-column]="selectedColumns().includes($index)">
            {{ cell }}
          </td>
          }
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<!-- Exported Data Table -->
@if (processedData().length > 0) {
<div class="table-section">
  <h3>Exported Data</h3>
  <div class="table-container">
    <table class="csv-table">
      <thead>
        <tr>
          <th class="row-number">#</th>
          @for (header of processedHeaders(); track $index) {
          <th>{{ header }}</th>
          }
        </tr>
      </thead>
      <tbody>
        @for (row of processedData(); track $index) {
        <tr>
          <td class="row-number">{{ $index + 1 }}</td>
          @for (cell of row; track $index) {
          <td>{{ cell }}</td>
          }
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
} } @else {
<p class="no-data">
  No data loaded. Please select a Goodwill CSV or Excel file.
</p>
}
